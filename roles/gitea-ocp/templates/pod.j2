apiVersion: v1
kind: Pod
metadata:
  name: "{{ _gitea_name }}"
  namespace: "{{ _gitea_namespace }}"
  labels:
    app: "{{ _gitea_name }}"
spec:
  serviceAccountName: "{{ _gitea_name }}"
  containers:
  - image: "{{ _gitea_image }}:{{ _gitea_image_tag }}"
    imagePullPolicy: IfNotPresent
    name: gitea
    ports:
    - containerPort: 3000
      protocol: TCP
    readinessProbe:
      httpGet:
        path: /
        port: 3000
        scheme: HTTP
      initialDelaySeconds: 10
      timeoutSeconds: 1
      periodSeconds: 20
      successThreshold: 1
      failureThreshold: 3
    livenessProbe:
      httpGet:
        path: /
        port: 3000
        scheme: HTTP
      initialDelaySeconds: 10
      timeoutSeconds: 1
      periodSeconds: 10
      successThreshold: 1
      failureThreshold: 3
    resources:
      request:
        cpu: "{{ _gitea_cpu_request }}"
        memory: "{{ _gitea_memory_request}}"
      limits:
        cpu: "{{ _gitea_cpu_limit}}"
        memory: "{{ _gitea_memory_limit }}"
    volumeMounts:
    - name: gitea-repositories
      mountPath: /gitea-repositories
    - name: gitea-config
      mountPath: /home/gitea/conf
  dnsPolicy: ClusterFirst
  restartPolicy: Always
  terminationGracePeriodSeconds: 30
  volumes:
  - name: gitea-repositories
    persistentVolumeClaim:
      claimName: "{{ _gitea_name }}-pvc"
  - name: gitea-config
    configMap:
      name: "{{ _gitea_name }}-config"
      items:
        - key: app.ini
          path: app.ini
